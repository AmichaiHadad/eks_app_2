# MySQL Helm chart values
mysql:
  # Use StatefulSet instead of Deployment
  architecture: standalone
  
  # Schedule on data nodes
  primary:
    nodeSelector:
      node-role: data
    tolerations:
      - key: role
        value: data
        effect: NoSchedule
    
    # Resource allocations
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi
    
    # Persistent storage
    persistence:
      enabled: true
      storageClass: "gp3"
      size: 20Gi
    
    # Security
    securityContext:
      fsGroup: 1001
      runAsUser: 1001
    
    # Health checks
    livenessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
      successThreshold: 1
    readinessProbe:
      enabled: true
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
      successThreshold: 1
  
  # Database configuration
  auth:
    # These will be overridden by External Secrets in production
    rootPassword: "placeholder-root-password"
    database: "app_db"
    username: "app_user"
    password: "placeholder-app-password"
  
  # Initialize database with app schema
  initdbScripts:
    app-init.sql: |
      CREATE DATABASE IF NOT EXISTS app_db;
      USE app_db;
      
      CREATE TABLE IF NOT EXISTS requests (
        id INT AUTO_INCREMENT PRIMARY KEY,
        timestamp DATETIME,
        client_ip VARCHAR(45),
        container_id VARCHAR(255)
      );
      
      -- Create app user with limited permissions
      CREATE USER IF NOT EXISTS 'app_user'@'%' IDENTIFIED BY '${MYSQL_PASSWORD}';
      GRANT SELECT, INSERT, UPDATE ON app_db.* TO 'app_user'@'%';
      FLUSH PRIVILEGES;
  
  # Service configurations
  service:
    type: ClusterIP
    port: 3306
  
  # Primary label
  primary:
    labels:
      role: mysql-primary
  
  # Additional security parameters
  securityContext:
    enabled: true
    fsGroup: 1001
    runAsUser: 1001